<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FabAI - Create Note</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>

    <h1>FabAI - Create Note</h1>

    <form id="noteForm">
        <!-- File Name Input -->
        <label for="file_name">File Name:</label>
        <input type="text" id="file_name" name="file_name" required>
        <br>

        <!-- Note Header Input -->
        <label for="note_header">Note Header:</label>
        <input type="text" id="note_header" name="note_header" required>
        <br>

        <!-- Tags Input -->
        <label for="tags">Tags (comma-separated):</label>
        <input type="text" id="tags" name="tags" placeholder="e.g., tag1, tag2" required>
        <br>

        <!-- Related Notes Input -->
        <label for="related_notes">Related Notes (comma-separated):</label>
        <input type="text" id="related_notes" name="related_notes" placeholder="e.g., note1, note2" required>
        <br>

        <!-- Result (Note Content) -->
        <label for="result">Note Content:</label>
        <textarea id="result" name="note_content" rows="4" cols="50" required></textarea>

        <br>

        <!-- Save Button -->
        <button type="button" onclick="saveNote()">Save Note</button>
    </form>

    <!-- Error message display -->
    <div class="error" id="errorMessage"></div>

    <script>
        function saveNote() {
            let file_name = document.getElementById('file_name').value;
            let note_header = document.getElementById('note_header').value;
            let note_content = document.getElementById('result').value;  // This is now 'result'
            let tags = document.getElementById('tags').value;
            let related_notes = document.getElementById('related_notes').value;
        
            // Send form data via AJAX to the submit_note route
            fetch('/submit_note', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    'file_name': file_name,
                    'note_header': note_header,
                    'note_content': note_content,  // Ensure this is correct
                    'tags': tags,
                    'related_notes': related_notes
                })
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      alert('Note saved successfully!');
                  } else {
                      document.getElementById('errorMessage').textContent = 'Error: ' + data.message;
                  }
              }).catch(error => {
                  document.getElementById('errorMessage').textContent = 'Error saving note: ' + error;
              });
        }
        
    </script>

</body>
</html>
