<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What can Fabric AI help you summarize?</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 50px;
            max-width: 100%;
        }
        h1 {
            font-size: 2.5rem;
        }
        .form-group, .btn {
            width: 100%;
        }
        #result {
            width: 100%;
            word-wrap: break-word;
            word-break: break-word;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            font-size: 1.2rem;
            margin-top: 0;
            padding-top: 10px;
        }
        label {
            font-size: 1.25rem;
        }
        .form-control, .btn {
            font-size: 1.2rem;
        }
        select.form-control {
            height: calc(2.5rem + 2px);
        }
        .error-message {
            color: red;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        @media (max-width: 768px) {
            h1 {
                font-size: 1.75rem;
            }
            #result {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">What can Fabric AI help you do today?</h1>
        <a href="/browse" class="btn btn-secondary btn-block">Browse Files</a>
        <form id="apiForm">
            <div class="form-group">
                <label for="operationtype">Operation Type</label>
                <select class="form-control" id="operationtype" name="operationtype" required>
                    <option value="claims" {% if operationtype == 'claims' %}selected{% endif %}>Claims</option>
                    <option value="keynote" {% if operationtype == 'keynote' %}selected{% endif %}>Keynote</option>
                    <option value="msummary" {% if operationtype == 'msummary' %}selected{% endif %}>MSummary</option>
                    <option value="summary" {% if operationtype == 'summary' %}selected{% endif %}>Summary</option>
                    <option value="essay" {% if operationtype == 'essay' %}selected{% endif %}>Essay</option>
                    <option value="wisdom" {% if operationtype == 'wisdom' %}selected{% endif %}>Wisdom</option>
                </select>
            </div>
            <div class="form-group">
                <label for="function">Function</label>
                <select class="form-control" id="function" name="function" required>
                    <option value="textInput" {% if function == 'textInput' %}selected{% endif %}>Text Input</option>
                    <option value="aivideo" {% if function == 'aivideo' %}selected{% endif %}>AIVideo</option>
                    <option value="aiweb" {% if function == 'aiweb' %}selected{% endif %}>AIWeb</option>
                </select>
            </div>
            <div class="form-group" id="textInputGroup" style="display: none;">
                <label for="textInput">Text Input</label>
                <textarea class="form-control" id="textInput" name="textInput" placeholder="Enter your text">{{ textInput }}</textarea>
                <div class="error-message" id="textInputError">Text input is required.</div>
            </div>
        
            <div class="form-group" id="urlGroup">
                <label for="url">URL</label>
                <input type="text" class="form-control" id="url" name="url" placeholder="Enter URL" value="{{ url }}">
                <div class="error-message" id="urlError">URL is required for AIWeb and AIVideo.</div>
            </div>
            <button type="submit" class="btn btn-primary btn-block" id="submitBtn">Let's Go</button>
        </form>
        
        <form id="renameForm" action="/rename" method="POST">
            <label for="newfilename">File Name:</label>
            <input type="text" id="newfilename" name="newfilename" required value="{{ filename }}">   
            <input type="hidden" name="operationtype" value="{{ operationtype }}">
            <input type="hidden" name="function" value="{{ function }}">
            <input type="hidden" name="textInput" value="{{ textInput }}">
            <input type="hidden" name="url" value="{{ url }}">
            <input type="hidden" name="currentfilename" value="{{ currentfilename }}">
            <input type="hidden" name="currentfiledirectory" value="{{ currentfiledirectory }}">
            <input type="hidden" name="result" value="{{ result }}"> <!-- Add any additional fields needed -->
            <button type="submit">Rename File</button>
        </form>
        
        <div id="result">{{ result }}</div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const functionSelect = document.getElementById('function');
            const textInputGroup = document.getElementById('textInputGroup');
            const urlGroup = document.getElementById('urlGroup');
            const textInput = document.getElementById('textInput');
            const urlInput = document.getElementById('url');
            const resultDiv = document.getElementById('result');
            const submitBtn = document.getElementById('submitBtn');

            function toggleInputs() {
                const selectedFunction = functionSelect.value;
                
                if (selectedFunction === 'textInput') {
                    textInputGroup.style.display = 'block';
                    urlGroup.style.display = 'none';
                    urlInput.value = '';  // Clear URL if it's not needed
                } else {
                    textInputGroup.style.display = 'none';
                    urlGroup.style.display = 'block';
                    textInput.value = '';  // Clear text input if it's not needed
                }
            }

            // Initial toggle on page load
            toggleInputs();

            // Change inputs visibility on function change
            functionSelect.addEventListener('change', toggleInputs);

            document.getElementById('apiForm').onsubmit = function (e) {
                e.preventDefault();
                let valid = true;

                // Clear the result div on submit
                resultDiv.innerHTML = '';

                // Validate inputs and set error messages as needed...
                if (valid) {
                    const formData = new FormData(this);
                    submitBtn.textContent = 'Working on it...';
                    submitBtn.disabled = true;

                    fetch('/submit', {
                        method: 'POST',
                        body: JSON.stringify(Object.fromEntries(formData)),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(response => response.json()).then(result => {
                        if (result.error) {
                            resultDiv.innerHTML = result.error;
                        } else {
                            const fullPath = result.filename;
                            const lastSlashIndex = fullPath.lastIndexOf('/');

                            const currentfiledirectory = lastSlashIndex !== -1 ? fullPath.substring(0, lastSlashIndex) : '';
                            const currentfilename = lastSlashIndex !== -1 ? fullPath.substring(lastSlashIndex + 1) : fullPath;

                            // Check if values are being set correctly
                            console.log("Current Filename:", currentfilename);
                            console.log("Current File Directory:", currentfiledirectory);

                            // Set values for the rename form
                            document.getElementById('newfilename').value = currentfilename; // Set new filename
                            document.querySelector('input[name="currentfilename"]').value = currentfilename; // Set current filename
                            document.querySelector('input[name="currentfiledirectory"]').value = currentfiledirectory; // Set current directory
                            
                            // Add these lines to set other values from apiForm
                            document.querySelector('input[name="operationtype"]').value = document.getElementById('operationtype').value; // Pass operation type
                            document.querySelector('input[name="function"]').value = document.getElementById('function').value; // Pass function
                            document.querySelector('input[name="textInput"]').value = document.getElementById('textInput').value; // Pass text input
                            document.querySelector('input[name="url"]').value = document.getElementById('url').value; // Pass URL

                            // Log all values being set to the rename form
                            console.log("Renaming Values:");
                            console.log("Operation Type:", document.querySelector('input[name="operationtype"]').value);
                            console.log("Function:", document.querySelector('input[name="function"]').value);
                            console.log("Text Input:", document.querySelector('input[name="textInput"]').value);
                            console.log("URL:", document.querySelector('input[name="url"]').value);

                            // Update the resultDiv with the output value
                            resultDiv.innerHTML = result.output || 'No output received.';
                        }
                    }).finally(() => {
                        submitBtn.textContent = "Let's Go";
                        submitBtn.disabled = false;
                    });
                }
            };
        });
    </script>
</body>
</html>
